# Relatedness, Complexity and Local Growth

This repository contains the source material for [Motu Working Paper 19-01][wp-url].
Its purpose is to provide a public record of our methods and results, and to ensure that those results are easily reproducible.

## Data

We derive the two workbooks in `data/raw/` from 1976--2013 New Zealand census data.
`emp_ioct.xlsx` provides usual resident employment counts by urban area, industry, occupation and census year. 
`emp_ict.xlsx` aggregates these counts by urban area, industry and census year.
Employment counts are randomly rounded and suppressed according to [the 2013 census confidentiality rules](http://archive.stats.govt.nz/Census/2013-census/methodology/confidentiality-how-applied).

`data/lookups/` contains lookup tables based on [industry](http://archive.stats.govt.nz/methods/classifications-and-standards/classification-related-stats-standards/industrial-classification.aspx), [occupation](http://archive.stats.govt.nz/methods/classifications-and-standards/classification-related-stats-standards/occupation.aspx) and [urban area](http://archive.stats.govt.nz/methods/classifications-and-standards/classification-related-stats-standards/urban-area.aspx) classifications available on the Statistics New Zealand website.

All other files in `data/` are generated by files described in [the table below](#file-descriptions).

## Code

We perform our analysis in [RStudio](https://www.rstudio.com/) and [Stata/MP 15](https://www.stata.com/statamp/).

### File descriptions

We generate data, figures and tables by running the scripts in `code/` in the order tabulated below.
The first column identifies the dependency level for each script.
Stage 1 scripts have no prerequisites; all other scripts use output generated by scripts in the previous stage.
We run each `.R` script in a fresh `relatedness-complexity.Rproj` instance.

Stage | File | Description
:---:| --- | ---
1 | `employment.R` | Exports panel data on usual resident employment by urban area, industry, occupation and census year. Also tabulates annual employment by urban area, industry class and occupation.
2 | `observations.R` | Exports attribute data for our selected cities and activities, and city, activity and mixed (city-activity) pairs. Also tabulates annual employment by urban area within our data.
2 | `suppression-rates.R` | Tabulates suppressed and unsuppressed annual employment, and overall suppression rates, within our data and nationally.
3 | `activity-space.R` | Generates network maps of activity space, with nodes coloured by sector and by occupation.
3 | `complexity-growth.R` | Plots annualised decadal growth in activity employment against lagged activity complexity.
3 | `smart-specialisation.R` | Plots activity complexity against mean local relatedness for locally under-represented activities in each city in our data. Also exports the plotted data.
3 | `complexity-series.R` | Plots activity and city complexity across census years by complexity subsample membership.
3 | `regressions.do` | Tabulates our main and subsample regression results, and exports the transformed data used in our analysis.

Most data, figures and tables are output to subfolders (of `data/`, `figures/` and `tables/`, respectively) named after the generating script.
For example, `employment.R` outputs tables to `tables/employment/`.
The exceptions are `smart-specialisation.R`, `suppression-rates.R` and `regressions.do`, which output to the root level of `figures/`, `tables/` and `data/`, respectively.

### Dependencies

We use various R packages from the [tidyverse](https://www.tidyverse.org/) to read, manipulate and write data.
We use [`igraph`](http://igraph.org/r/) to create network maps of activity space based on an adjacency matrix built using the `cor` function from [`WGCNA`](https://cran.r-project.org/package=WGCNA).
These packages can be installed by executing

```r
# Install igraph and tidyverse packages
install.packages(c("igraph", "tidyverse"))

# Install WGCNA package
install.packages("BiocManager")
BiocManager::install("WGCNA")
```

at the R console.
We also use [`foreign`](https://cran.r-project.org/package=foreign) (included in the base R installation) to export `.dta` files.
We identify required packages at the beginning of each script.

Finally, we create regression tables in Stata using the [`estout`](http://repec.sowi.unibe.ch/stata/estout/) package, which can be installed by running

```stata
ssc install estout, replace
```

in the Stata command console.

## Legal

All repository content is licensed under the [MIT license](https://github.com/moturesearch/relatedness-complexity/blob/master/LICENSE).

Access to the 1976--2013 New Zealand census data was provided by Statistics New Zealand under conditions designed to give effect to the security and confidentiality provisions of the [Statistics Act 1975](http://www.legislation.govt.nz/act/public/1975/0001/latest/DLM430705.html).

[wp-url]: https://motu.nz/our-work/urban-and-regional/regions/relatedness-complexity-and-local-growth
